var GeoConvert={};GeoConvert.emptyGeojson=function(){var e={};return e.type="FeatureCollection",e.features=[],e},GeoConvert.decode={},GeoConvert.decode.utf8=new TextDecoder("utf-8"),GeoConvert.decode.big5=new TextDecoder("big5"),function(e,t,r){function o(e){var t={};if(e.attributes)for(var r=0,n=e.attributes.length;n>r;r++){var a=e.attributes[r],i=a.nodeValue,s=!isNaN(parseFloat(i))&&isFinite(i)?parseFloat(i):i;t["@"+a.nodeName]=s}if(e.children.length>0)for(var c={},r=0,n=e.children.length;n>r;r++){var l=e.children[r];"_"!==l.tagName[0]?t[l.tagName]?(c[l.tagName]||(t[l.tagName]=[t[l.tagName]],c[l.tagName]=!0),t[l.tagName].push(o(l))):(t[l.tagName]=o(l),c[l.tagName]=!1):c[l.tagName]?t.push(o(l)):(t=[o(l)],c[l.tagName]=!0)}else{var p=e.textContent,s=!isNaN(parseFloat(p))&&isFinite(p)?parseFloat(p):p;Object.keys(t).length>0?t["#"]=s:t=s}return t}function n(e,t,r){var o=r.createElement(e);if(t.forEach)t.forEach(function(e){var t=n("_array",e,r);o.appendChild(t)});else if("object"==typeof t)for(var a in t)if("@"===a[0]){var e=a.replace("@","");o.setAttribute(e,t[a])}else if("#"===a)o.textContent=t[a];else if("object"!=typeof t[a]){var i=r.createElement(a);i.textContent=t[a],o.appendChild(i)}else if(t[a].forEach&&t[a].sameName)t[a].forEach(function(e){var t=n(a,e,r);o.appendChild(t)});else{var i=n(a,t[a],r);o.appendChild(i)}else o.textContent=t;return o}GeoConvert.xml2Json=function(t,r){var n;n=e.DOMParser?function(t){return(new e.DOMParser).parseFromString(t,"text/xml")}:"undefined"!=typeof e.ActiveXObject&&new e.ActiveXObject("Microsoft.XMLDOM")?function(t){var r=new e.ActiveXObject("Microsoft.XMLDOM");return r.async="false",r.loadXML(t),r}:function(){return null};var a;if("string"==typeof t)a=n(t);else{if("object"!=typeof t||!t.xmlVersion)throw new Error("Unsupported input type");a=t}var i=o(a);if(r){var s=JSON.stringify(i);return s}return i},GeoConvert.json2Xml=function(e,r,o){var a;a="string"==typeof e?JSON.parse(e):e;var i,s=r.trim()?r:"root",c=t.implementation.createDocument(null,"create");if(i=n(s,a,c),o){var l="<?xml version='1.0' encoding='UTF-8'?>"+(new XMLSerializer).serializeToString(i);return l}return i}}(window,document),function(e,t,r){function o(e,t,r,i){switch(e){case"kml":case"Document":case"Folder":if(t.forEach)t.forEach(function(t){o(e,t,r,i)});else{var s=Object.keys(t),c=s.indexOf("Style");l>-1&&(s.splice(l,1),o("StyleMap",t.StyleMap,r,i));var l=s.indexOf("StyleMap");c>-1&&(s.splice(c,1),o("Style",t.Style,r,i)),s.forEach(function(e){o(e,t[e],r,i)})}break;case"Placemark":t.forEach?t.forEach(function(e){r.features.push(a(e,i))}):r.features.push(a(t,i));break;case"Style":case"StyleMap":t.forEach?t.forEach(function(e){e["@id"]&&(i[e["@id"]]=e)}):t["@id"]&&(i[t["@id"]]=t);break;case"GroundOverlay":t.forEach?t.forEach(function(e){r.features.push(n(e))}):r.features.push(n(t))}}function n(e){var t={};if(t.type="Feature",t.properties={},t.geometry=null,e.name&&(t.properties.name=e.name),e.description&&(t.properties.description=e.description),e.Icon&&e.Icon.href&&(t.properties.iconUrl=e.Icon.href),e.visibility&&(t.properties.opacity=parseFloat(e.visibility)),e.LatLonBox){latLonBox=e.LatLonBox;var r=[parseFloat(latLonBox.south),parseFloat(latLonBox.west)],o=[parseFloat(latLonBox.north),parseFloat(latLonBox.east)],n=[r,o];t.properties.latLngBounds=n}return t}function a(e,t){var r={};if(r.type="Feature",r.properties={},r.style={},e.name&&(r.properties.name=e.name),e.description&&(r.properties.description=e.description),e["gx:MultiTrack"]){var o={},n=[],a=e["gx:MultiTrack"],c=a["gx:Track"],l=c["gx:coord"];l&&l.forEach(function(e){if(""!==e.trim()){var t=e.split(" ");n.push([parseFloat(t[0]),parseFloat(t[1])])}}),c.when&&(r.properties.when=c.when),c.ExtendedData&&c.ExtendedData.SchemaData&&c.ExtendedData.SchemaData["gx:SimpleArrayData"]&&c.ExtendedData.SchemaData["gx:SimpleArrayData"].forEach(function(e){r.properties[e["@name"]]=e["gx:value"]}),o.type="LineString",o.coordinates=n,r.geometry=o}else r.geometry=i(e);var p=e.Style||{};if(e.styleUrl){var u=e.styleUrl.replace("#","");if(t[u]){var f,y;t[u].Pair?(t[u].Pair.forEach(function(e){e.key&&"normal"===e.key&&(y=e.styleUrl.replace("#",""))}),f=t[y]):f=t[u];var v=Object.keys(Object.assign({},p,f));v.forEach(function(e){var t=typeof p[e];"object"===t?p[e]=Object.assign({},p[e],f[e]):"undefined"===t&&(p[e]=f[e])})}}for(var g in p)switch(g){case"IconStyle":var h=p.IconStyle.Icon.href,m=p.IconStyle.scale,d=p.IconStyle.color;if(h&&(r.style.iconUrl=h),m&&(r.style.scale=parseFloat(m)),d&&(d=s(d),r.style.color=d.hex,r.style.opacity=d.opacity),p.IconStyle.hotSpot){var S=parseFloat(p.IconStyle.hotSpot["@x"]),b=parseFloat(p.IconStyle.hotSpot["@y"]);r.style.iconAnchor=[S,b]}break;case"LineStyle":var d=s(p.LineStyle.color),x=parseFloat(p.LineStyle.width);d&&(r.style.color=d.hex,r.style.opacity=d.opacity),x&&(r.style.weight=x);break;case"PolyStyle":var d=s(p.PolyStyle.color),w=parseInt(w),F=parseInt(p.PolyStyle.outline);d&&(r.style.fillColor=d.hex,r.style.fillOpacity=d.opacity),w&&(r.style.fill=w),F&&(r.style.stroke=F)}return r}function i(e){var t={};if(e.Point)if(e.Point.forEach){var r=[];e.Point.forEach(function(e){var t=[],o=e.coordinates.replace(/\t|\n/gi,"");if(""!==o.trim()){var n=o.split(",");t=[parseFloat(n[0]),parseFloat(n[1])]}r.push(t)}),t.type="MultiPoint",t.coordinates=r}else{var r=[],o=e.Point.coordinates.replace(/\t|\n/gi,"");if(""!==o.trim()){var n=o.split(",");r=[parseFloat(n[0]),parseFloat(n[1])]}t.type="Point",t.coordinates=r}else if(e.LineString)if(e.LineString.forEach){var r=[];e.LineString.forEach(function(e){var t=[],o=e.coordinates.replace(/\t|\n/gi,"");o.split(" ").forEach(function(e){if(""!==e.trim()){var r=e.split(",");t.push([parseFloat(r[0]),parseFloat(r[1])])}}),r.push(t)}),t.type="MultiLineString",t.coordinates=r}else{var r=[],a=e.LineString.coordinates.replace(/\t|\n/gi,"");a.split(" ").forEach(function(e){if(""!==e.trim()){var t=e.split(",");r.push([parseFloat(t[0]),parseFloat(t[1])])}}),t.type="LineString",t.coordinates=r}else if(e.Polygon)if(e.Polygon.forEach){var r=[];e.Polygon.forEach(function(e){var t=[];["outerBoundaryIs","innerBoundaryIs"].forEach(function(r){var o=e[r];if(o){var n=[],a=o.LinearRing.coordinates.replace(/\t|\n/gi,"");a.split(" ").forEach(function(e){if(""!==e.trim()){var t=e.split(",");n.push([parseFloat(t[0]),parseFloat(t[1])])}}),t.push(n)}}),r.push(t)}),t.type="MultiPolygon",t.coordinates=r}else{var r=[];["outerBoundaryIs","innerBoundaryIs"].forEach(function(t){var o=e.Polygon[t];if(o){var n=[],a=o.LinearRing.coordinates.replace(/\t|\n/gi,"");a.split(" ").forEach(function(e){if(""!==e.trim()){var t=e.split(",");n.push([parseFloat(t[0]),parseFloat(t[1])])}}),r.push(n)}}),t.type="Polygon",t.coordinates=r}else if(e.MultiGeometry){var s=e.MultiGeometry;if(Object.keys(s).length>1){var c=[];for(var l in s)if(s[l].forEach)s[l].forEach(function(e){var t={};t[l]=e,c.push(i(t))});else{var p={};p[l]=s[l],c.push(i(p))}t.type="GeometryCollection",t.geometries=c}else t=i(s)}return t}function s(e){var t={};return t.hex="#"+e.slice(6,8)+e.slice(4,6)+e.slice(2,4),t.opacity=Math.round(parseInt(e.slice(0,2),16)/255*100)/100,t}function c(){var e={};return e["@xmlns"]="http://www.opengis.net/kml/2.2",e["@xmlns:gx"]="http://www.google.com/kml/ext/2.2",e["@xmlns:kml"]="http://www.opengis.net/kml/2.2",e["@xmlns:atom"]="http://www.w3.org/2005/Atom",e.Document={},e}function l(e,t,r){switch(e.type){case"Point":case"LineString":case"Polygon":var o=e.type;if(t[o]){var n=u(o,e.coordinates);t[o].push||(t[o]=[t[o]],t[o].sameName=!0),t[o].push(n)}else t[o]=u(o,e.coordinates);break;case"MultiPoint":case"MultiLineString":case"MultiPolygon":var o=e.type.replace("Multi","");t.MultiGeometry={},e.coordinates.forEach(function(e){l({type:o,coordinates:e},t.MultiGeometry)});break;case"GeometryCollection":t.MultiGeometry={},e.geometries.forEach(function(e){l(e,t.MultiGeometry)});break;case"Feature":var n={};l(e.geometry,n),e.properties.name&&(n.name=e.properties.name),e.properties.description&&(n.description=e.properties.description);var a=p(e,r);n.styleUrl=a,t.push(n);break;case"FeatureCollection":e.features.forEach(function(e){l(e,t,r)})}}function p(e,t){var r=Object.assign({},e.style),o=0;return t.forEach(function(e,t){var n=!1;for(var a in r)r[a]!==e[a]&&(n=!0);n||(o=t+1)}),0===o&&(t.push(r),o=t.length),"custom"+o}function u(e,t){var r={};switch(e){case"Point":r={},r.coordinates=t.join();break;case"LineString":r={},r.tessellate=1,r.coordinates=t.join(" ");break;case"Polygon":r={},r.tessellate=1,r.outerBoundaryIs={},r.outerBoundaryIs.LinearRing={},r.outerBoundaryIs.LinearRing.coordinates=t[0].join(" "),t.shift(),t.forEach(function(e){r.innerBoundaryIs={},r.innerBoundaryIs.LinearRing={},r.innerBoundaryIs.LinearRing.coordinates=e.join(" ")})}return r}function f(e){var t={};t.stroke="outline",t.fill="fill";var r=e.map(function(e,t){var r={};r["@id"]="custom"+(t+1);for(var o in e){switch(o){case"iconUrl":case"iconAnchor":case"scale":r.IconStyle||(r.IconStyle={});break;case"color":case"weight":r.LineStyle||(r.LineStyle={});break;case"stroke":case"fill":case"fillColor":r.PolyStyle||(r.PolyStyle={})}switch(o){case"iconUrl":r.IconStyle.Icon={},r.IconStyle.Icon.href=e.iconUrl;break;case"iconAnchor":r.IconStyle.hotSpot={},r.IconStyle.hotSpot["@x"]=e.iconAnchor[0],r.IconStyle.hotSpot["@y"]=e.iconAnchor[1],r.IconStyle.hotSpot["@xunits"]="pixels",r.IconStyle.hotSpot["@yunits"]="pixels";break;case"scale":r.IconStyle.scale=e.scale;break;case"color":r.LineStyle.color=y(e.color,e.opacity);break;case"weight":r.LineStyle.width=e.weight;break;case"stroke":r.PolyStyle.outline=e.stroke;case"fill":r.PolyStyle.fill=e.fill;break;case"fillColor":r.PolyStyle.color=y(e.fillColor,e.fillOpacity)}}return r});return r.sameName=!0,r}function y(e,t){e=e.replace("#",""),t=t?t:1;var r=parseInt(255*t).toString(16),o=r+e.slice(4,6)+e.slice(2,4)+e.slice(0,2);return o}GeoConvert.kml2Geojson=function(e,t){var r;if("string"==typeof e)if(-1!==e.indexOf("kml:")){var n=e.replace(/\kml:/gi,"");r=GeoConvert.xml2Json(n)}else r=GeoConvert.xml2Json(e);else{if("object"!=typeof e||!e.xmlVersion)throw new Error("Unsupported input type");r=GeoConvert.xml2Json(e)}var a=GeoConvert.emptyGeojson(),i={};if(o("kml",r.kml,a,i),t){var s=JSON.stringify(a);return s}return a},GeoConvert.geojson2Kml=function(e,t){var r;r="string"==typeof e?JSON.parse(e):e;var o=c(),n=[],a=[];n.sameName=!0,"Feature"!==r.type&&"FeatureCollection"!==r.type&&(r={type:"Feature",geometry:r,properties:{}}),l(r,n,a),o.Document.Style=f(a),o.Document.Placemark=n;var i=GeoConvert.json2Xml(o,"kml");if(t){var s="<?xml version='1.0' encoding='UTF-8'?>"+(new XMLSerializer).serializeToString(i);return s}return i}}(window,document),function(e,t,r){GeoConvert.kmz2Geojsons=function(e,t){function r(){if(o--,0===o){var e=[];a.forEach(function(t){var r=GeoConvert.kml2Geojson(t);r.features.forEach(function(e){e.style&&e.style.iconUrl&&i[e.style.iconUrl]&&(e.style.iconUrl=i[e.style.iconUrl])}),e.push(r)}),t&&t(e)}}if(JSZip){var o=0,n=new JSZip,a=[],i={};n.loadAsync(e).then(function(e){for(var t in n.files){o++;var s=n.file(t).name.split(".").pop();"kml"===s?e.file(t).async("string").then(function(e){a.push(e),r()},function(e){o--}):"png"===s||"jpg"===s?e.file(t).async("base64").then(function(e){var o="data:image/"+s+";base64,";i[t]=o+e,r()},function(e){o--}):o--}})}}}(window,document),function(e,t,r){function o(e,t,r){if("gpx"===e)for(var s in t)o(s,t[s],r);else{var c;switch(e){case"wpt":c=n;break;case"trk":c=a;break;case"rte":c=i}c&&(t.forEach?t.forEach(function(e){r.features.push(c(e))}):r.features.push(c(t)))}}function n(e){var t={};t.type="Feature",t.properties={},t.properties.name=e.name,t.properties.cmt=e.cmt,t.properties.desc=e.desc,t.properties.time=e.time,t.geometry={},t.geometry.type="Point";var r=[e["@lon"],e["@lat"]];return t.geometry.coordinates=r,t}function a(e){var t={};t.type="Feature",t.properties={},t.properties.name=e.name,t.geometry={};var r;if(e.trkseg&&e.trkseg.trkpt){var o=e.trkseg.trkpt;o.forEach?(t.geometry.type="LineString",r=[],o.forEach(function(e){var t=[e["@lon"],e["@lat"]];r.push(t)})):(t.geometry.type="Point",r=[o["@lon"],o["@lat"]])}return t.geometry.coordinates=r,t}function i(e){var t={};t.type="Feature",t.properties={},t.properties.name=e.name,t.geometry={};var r;if(e.rtept){var o=e.rtept;o.forEach?(t.geometry.type="LineString",r=[],o.forEach(function(e){var t=[e["@lon"],e["@lat"]];r.push(t)})):(t.geometry.type="Point",r=[o["@lon"],o["@lat"]])}return t.geometry.coordinates=r,t}function s(){var e={};return e["@xmlns"]="http://www.topografix.com/GPX/1/1",e["@version"]="1.1",e["@creator"]="GeoConvert",e.metadata={},e.metadata.name="Geojson to GPX",e}function c(e,t,r,o){switch(e.type){case"Point":var n=l(e.coordinates);n.name=o.name?o.name:"",t.push(n);break;case"LineString":var a=p(e.coordinates);a.name=o.name?o.name:"",r.push(a);break;case"MultiPoint":case"MultiLineString":var i=e.type.replace("Multi","");e.coordinates.forEach(function(e){c({type:i,coordinates:e},t,r,o)});break;case"GeometryCollection":e.geometries.forEach(function(e){c(e,t,r,o)});break;case"Feature":c(e.geometry,t,r,e.properties);break;case"FeatureCollection":e.features.forEach(function(e){c(e,t,r)})}}function l(e){var t={};return t["@lon"]=e[0],t["@lat"]=e[1],t}function p(e){var t={};return t.rtept=[],t.rtept.sameName=!0,e.forEach(function(e){var r={};r["@lon"]=e[0],r["@lat"]=e[1],t.rtept.push(r)}),t}GeoConvert.gpx2Geojson=function(e,t){var r;if("string"==typeof e)r=GeoConvert.xml2Json(e);else{if("object"!=typeof e||!e.xmlVersion)throw new Error("Unsupported input type");r=GeoConvert.xml2Json(e)}var n=GeoConvert.emptyGeojson();if(o("gpx",r.gpx,n),t){var a=JSON.stringify(n);return a}return n},GeoConvert.geojson2Gpx=function(e,t){var r;r="string"==typeof e?JSON.parse(e):e;var o=s(),n=[],a=[];n.sameName=!0,a.sameName=!0,"Feature"!==r.type&&"FeatureCollection"!==r.type&&(r={type:"Feature",geometry:r,properties:{}}),c(r,n,a),o.wpt=n,o.rte=a;var i=GeoConvert.json2Xml(o,"gpx");if(t){var l="<?xml version='1.0' encoding='UTF-8'?>"+(new XMLSerializer).serializeToString(i);return l}return i}}(window,document),function(e,t,r){function o(e){if(e.shp&&e.dbf){var t=GeoConvert.emptyGeojson(),r=e.prj,o=e.encoding;return a(e.shp,t,r),f(e.dbf,t,o),t}throw new Error("need complete shapefile")}function n(e,t){this.fromProjection=e,this.toProjection=t}function a(e,t,r){var o=new DataView(e),a=o.byteLength,c=(o.getInt32(24),o.getInt32(32,!0),o.getFloat64(36,!0),o.getFloat64(44,!0),o.getFloat64(52,!0),o.getFloat64(60,!0),r&&!/GCS_WGS_1984|WGS84/g.test(r)?new n(r,proj4.WGS84):c);t.bbox=s(o,36,c);for(var l=100;a>l;){var p=i(o,l,c);t.features.push(p.feature),l=p.byteOffset}}function i(e,t,r){var o={},n={};n.type="Feature";var a=(e.getInt32(t),e.getInt32(t+4)),i=e.getInt32(t+8,!0);t+=12;var s;switch(i){case 0:break;case 1:case 11:case 21:s=c;break;case 3:case 13:case 23:s=p;break;case 5:case 15:case 25:s=u;break;case 8:case 18:s=l;break;case 28:break;case 31:}if(s){var f={},y=s(e,t,r);f.type=y.type,f.coordinates=y.coordinates,y.box&&(n.bbox=y.box),n.geometry=f}return o.feature=n,o.byteOffset=t+2*a-4,o}function s(e,t,r){var o,n=e.getFloat64(t,!0),a=e.getFloat64(t+8,!0),i=e.getFloat64(t+16,!0),s=e.getFloat64(t+24,!0);return o=r?r.trans([n,a]).concat(r.trans([i,s])):[n,a,i,s]}function c(e,t,r){var o={},n=e.getFloat64(t,!0),a=e.getFloat64(t+8,!0);return t+=16,o.type="Point",o.coordinates=r?r.trans([n,a]):[n,a],o}function l(e,t,r){var o={},n=s(e,t,r),a=e.getInt32(t+32,!0),i=[];t+=36;for(var c=0;a>c;c++){var l=e.getFloat64(t,!0),p=e.getFloat64(t+8,!0),u=r?r.trans([l,p]):[l,p];i.push(u),t+=16}return o.type="MultiPoint",o.box=n,o.coordinates=i,o}function p(e,t,r){for(var o={},n=s(e,t,r),a=e.getInt32(t+32,!0),i=e.getInt32(t+36,!0),c=[],l=[],p=[],u=0;a>u;u++){var f=e.getInt32(t+40+4*u,!0)-1;c.push(f)}c.push(i-1),t=t+40+4*a;for(var u=0;i>u;u++){var y=e.getFloat64(t,!0),v=e.getFloat64(t+8,!0),g=r?r.trans([y,v]):[y,v];l.push(g),t+=16,-1!==c.indexOf(u)&&(p.push(l),l=[])}return o.box=n,o.numPoints=i,1===a?(o.type="LineString",o.coordinates=p[0]):(o.type="MultiLineString",o.coordinates=p),o}function u(e,t,r){for(var o={},n=s(e,t,r),a=e.getInt32(t+32,!0),i=e.getInt32(t+36,!0),c=[],l=[],p=[],u=[],f=null,y=null,v=0,g=0;a>g;g++){var h=e.getInt32(t+40+4*g,!0)-1;c.push(h)}c.push(i-1),t=t+40+4*a;for(var g=0;i>g;g++){var m=e.getFloat64(t,!0),d=e.getFloat64(t+8,!0),S=r?r.trans([m,d]):[m,d];l.push(S),t+=16,f&&y||([f,y]=[m,d]),v+=(m-f)*(d+y),[f,y]=[m,d],-1!==c.indexOf(g)&&(p.push(l),v>=0?u.push(p):u[u.length-1]=u[u.length-1].concat(p),l=[],p=[],v=0,[f,y]=[null,null])}return o.box=n,o.numPoints=i,1===a?(o.type="Polygon",o.coordinates=u[0]):(o.type="MultiPolygon",o.coordinates=u),o}function f(e,t,r){var o,n=new DataView(e),a=(n.byteLength,n.getInt8(0)),i=n.getInt32(4,!0),s=n.getInt16(8,!0),c=n.getInt16(10,!0),l=r||n.getInt8(29);switch(l){case 79:case"0x4F":o=GeoConvert.decode.big5;break;default:o=GeoConvert.decode.utf8}if(3!==a)throw new Error("File has unknown/unsupported dBase version:"+a);for(var p=32,u=[];13!==n.getUint8(p);){var f={};f.name=o.decode(e.slice(p,p+10)).replace(/\u0000/g,""),f.type=y[o.decode(e.slice(p+11,p+12))],f.fieldLength=n.getUint8(p+16),f.decimals=n.getUint8(p+17),u.push(f),p+=32}for(var v=u.length,g=0;i>g;g++){var h={};p=s+g*c,p+=1;for(var m=0;v>m;m++){var d=u[m],S=o.decode(e.slice(p,p+d.fieldLength)).trim();h[d.name]=S,p+=d.fieldLength}t.features[g].properties=h}}var y={N:"Number",C:"Character",L:"Logical",D:"Date",M:"Memo",F:"Floating point",B:"Binary",G:"General",P:"Picture",Y:"Currency",T:"DateTime",I:"Integer",V:"VariField",X:"Variant","@":"Timestamp",O:"Double","+":"Autoincrement"};GeoConvert.shapefile2Geojson=function(e,t){var r=o(e);if(t){var n=JSON.stringify(r);return n}return r},n.prototype.trans=function(e){return proj4(this.fromProjection,this.toProjection,e)}}(window,document);